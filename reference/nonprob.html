<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="nonprob fits model for inference based on non-probability surveys (including big data) using various methods.
The function allows you to estimate the population mean having access to a reference probability sample as well as total/mean values of covariates.
In the package implemented state-of-the-art approaches recently proposed in the literature: Chen et al. (2020),
Yang et al. (2020), Wu (2022) and use survey package Lumley 2004 for inference.
Provided propensity score weighting (e.g. with calibration constraints), mass imputation (e.g. nearest neighbour) and
doubly robust estimators that take into account minimization of the asymptotic bias of the population mean estimators,
variable selection or overlap between random and non-random sample.
The package uses survey package functionalities when a probability sample is available."><title>Inference with the non-probability survey samples — nonprob • nonprobsvy</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Inference with the non-probability survey samples — nonprob"><meta property="og:description" content="nonprob fits model for inference based on non-probability surveys (including big data) using various methods.
The function allows you to estimate the population mean having access to a reference probability sample as well as total/mean values of covariates.
In the package implemented state-of-the-art approaches recently proposed in the literature: Chen et al. (2020),
Yang et al. (2020), Wu (2022) and use survey package Lumley 2004 for inference.
Provided propensity score weighting (e.g. with calibration constraints), mass imputation (e.g. nearest neighbour) and
doubly robust estimators that take into account minimization of the asymptotic bias of the population mean estimators,
variable selection or overlap between random and non-random sample.
The package uses survey package functionalities when a probability sample is available."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nonprobsvy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ncn-foreigners/nonprobsvy/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Inference with the non-probability survey samples</h1>
      <small class="dont-index">Source: <a href="https://github.com/ncn-foreigners/nonprobsvy/blob/HEAD/R/main_function_documentation.R" class="external-link"><code>R/main_function_documentation.R</code></a>, <a href="https://github.com/ncn-foreigners/nonprobsvy/blob/HEAD/R/nonprob.R" class="external-link"><code>R/nonprob.R</code></a></small>
      <div class="d-none name"><code>nonprob.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>nonprob</code> fits model for inference based on non-probability surveys (including big data) using various methods.
The function allows you to estimate the population mean having access to a reference probability sample as well as total/mean values of covariates.</p>
<p>In the package implemented state-of-the-art approaches recently proposed in the literature: Chen et al. (2020),
Yang et al. (2020), Wu (2022) and use <code>survey</code> package <a href="https://CRAN.R-project.org/package=survey" class="external-link">Lumley 2004</a> for inference.</p>
<p>Provided propensity score weighting (e.g. with calibration constraints), mass imputation (e.g. nearest neighbour) and
doubly robust estimators that take into account minimization of the asymptotic bias of the population mean estimators,
variable selection or overlap between random and non-random sample.
The package uses <code>survey</code> package functionalities when a probability sample is available.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">nonprob</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  selection <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outcome <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  target <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  svydesign <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pop_totals <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pop_means <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pop_size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method_selection <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logit"</span>, <span class="st">"cloglog"</span>, <span class="st">"probit"</span><span class="op">)</span>,</span>
<span>  method_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm"</span>, <span class="st">"nn"</span>, <span class="st">"pmm"</span><span class="op">)</span>,</span>
<span>  family_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="st">"binomial"</span>, <span class="st">"poisson"</span><span class="op">)</span>,</span>
<span>  subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  strata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  na_action <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control_selection <span class="op">=</span> <span class="fu"><a href="controlSel.html">controlSel</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  control_outcome <span class="op">=</span> <span class="fu"><a href="controlOut.html">controlOut</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  control_inference <span class="op">=</span> <span class="fu"><a href="controlInf.html">controlInf</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  start_selection <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  start_outcome <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  se <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p><code>data.frame</code> with data from the nonprobability sample.</p></dd>


<dt>selection</dt>
<dd><p><code>formula</code>, the selection (propensity) equation.</p></dd>


<dt>outcome</dt>
<dd><p><code>formula</code>, the outcome equation.</p></dd>


<dt>target</dt>
<dd><p><code>formula</code> with target variables.</p></dd>


<dt>svydesign</dt>
<dd><p>an optional <code>svydesign</code> object (from the survey package) containing probability sample and design weights.</p></dd>


<dt>pop_totals</dt>
<dd><p>an optional <code>named vector</code> with population totals of the covariates.</p></dd>


<dt>pop_means</dt>
<dd><p>an optional <code>named vector</code> with population means of the covariates.</p></dd>


<dt>pop_size</dt>
<dd><p>an optional <code>double</code> with population size.</p></dd>


<dt>method_selection</dt>
<dd><p>a <code>character</code> with method for propensity scores estimation</p></dd>


<dt>method_outcome</dt>
<dd><p>a <code>character</code> with method for response variable estimation</p></dd>


<dt>family_outcome</dt>
<dd><p>a <code>character</code> string describing the error distribution and link function to be used in the model. Default is "gaussian". Currently supports: gaussian with identity link, poisson and binomial.</p></dd>


<dt>subset</dt>
<dd><p>an optional <code>vector</code> specifying a subset of observations to be used in the fitting process.</p></dd>


<dt>strata</dt>
<dd><p>an optional <code>vector</code> specifying strata.</p></dd>


<dt>weights</dt>
<dd><p>an optional <code>vector</code> of prior weights to be used in the fitting process. Should be NULL or a numeric vector. It is assumed that this vector contains frequency or analytic weights</p></dd>


<dt>na_action</dt>
<dd><p>a function which indicates what should happen when the data contain <code>NAs</code>.</p></dd>


<dt>control_selection</dt>
<dd><p>a <code>list</code> indicating parameters to use in fitting selection model for propensity scores</p></dd>


<dt>control_outcome</dt>
<dd><p>a <code>list</code> indicating parameters to use in fitting model for outcome variable</p></dd>


<dt>control_inference</dt>
<dd><p>a <code>list</code> indicating parameters to use in inference based on probability and non-probability samples, contains parameters such as estimation method or variance method</p></dd>


<dt>start_selection</dt>
<dd><p>an optional <code>vector</code> with starting values for the parameters of the selection equation</p></dd>


<dt>start_outcome</dt>
<dd><p>an optional <code>vector</code> with starting values for the parameters of the outcome equation</p></dd>


<dt>verbose</dt>
<dd><p>verbose, numeric</p></dd>


<dt>x</dt>
<dd><p>Logical value indicating whether to return model matrix of covariates as a part of output.</p></dd>


<dt>y</dt>
<dd><p>Logical value indicating whether to return vector of outcome variable as a part of output.</p></dd>


<dt>se</dt>
<dd><p>Logical value indicating whether to calculate and return standard error of estimated mean.</p></dd>


<dt>...</dt>
<dd><p>Additional, optional arguments.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Returns an object of class <code>c("nonprobsvy", "nonprobsvy_dr")</code> in case of doubly robust estimator,
<code>c("nonprobsvy", "nonprobsvy_mi")</code> in case of mass imputation estimator and
<code>c("nonprobsvy", "nonprobsvy_ipw")</code> in case of inverse probability weighting estimator
with type <code>list</code> containing:<br></p>


<ul><li><p><code>X</code> -- model matrix containing data from probability and non-probability samples if specified at a function call.</p></li>
<li><p><code>y</code> -- list of vector of outcome variables if specified at a function call.</p></li>
<li><p><code>prob</code> -- vector of estimated propensity scores for non-probability sample.</p></li>
<li><p><code>weights</code> -- vector of estimated weights for non-probability sample.</p></li>
<li><p><code>control</code> -- list of control functions.</p></li>
<li><p><code>output</code> -- output of the model containing information about estimated population mean and standard errors.</p></li>
<li><p><code>SE</code> -- standard error of population mean estimator divided into errors coming from probability and non-probability samples.</p></li>
<li><p><code>confidence_interval</code> -- confidence interval of population mean estimator</p></li>
<li><p><code>coeff_selection</code> -- <code>data.frame</code> of estimated coefficients of the propensity score (inverse probability weighting) model and their standard errors.</p></li>
<li><p><code>coeff_outcome</code> -- <code>data.frame</code> of estimated coefficients of the outcome (mass imputation) model and their standard errors.</p></li>
<li><p><code>nonprob_size</code> -- size of non-probability sample</p></li>
<li><p><code>prob_size</code> -- size of probability sample</p></li>
<li><p><code>pop_size</code> -- estimated population size derived from estimated weights (non-probability sample) or known design weights (probability sample)</p></li>
<li><p><code>outcome</code> -- list containing information about fitting of mass imputation model, in case of regression model, object containing list returned by the function
<code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code>, in case of nearest neighbour imputation object containing list returned by <code><a href="https://rdrr.io/pkg/RANN/man/nn2.html" class="external-link">RANN::nn2()</a></code>. If <code>bias_correction</code> in <code><a href="controlInf.html">controlInf()</a></code> is set on <code>TRUE</code>, then estimation is based on
the joint estimating equations for <code>selection</code> and <code>outcome</code> model and therefore, the list differs from the one returned by the <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code> function and contains elements such as
</p><ul><li><p><code>coefficients</code> -- estimated coefficients of the regression model</p></li>
<li><p><code>std_err</code> -- standard errors of the estimated coefficients</p></li>
<li><p><code>residuals</code> -- The response residuals</p></li>
<li><p><code>variance_covariance</code> -- The variance-covariance matrix of the coefficient estimates</p></li>
<li><p><code>df_residual</code> -- The degrees of freedom for residuals</p></li>
<li><p><code>family</code> -- specifies the error distribution and link function to be used in the model</p></li>
<li><p><code>fitted.values</code> -- The predicted values of the response variable based on the fitted model</p></li>
<li><p><code>linear.predictors</code> -- The linear fit on link scale</p></li>
<li><p><code>X</code> -- The design matrix</p></li>
<li><p><code>method</code> -- set on <code>glm</code>, since the regression method</p></li>
</ul>

Additionally when variables selection model for outcome variable is fitting, list includes of <code>cve</code> -- the error for each value of <code>lambda</code>, averaged across the cross-validation folds.</li>
<li><p><code>selection</code> -- list containing information about fitting of propensity score model, such as
</p><ul><li><p><code>coefficients</code> -- a named vector of coefficients</p></li>
<li><p><code>std_err</code> -- standard errors of the estimated model coefficients</p></li>
<li><p><code>residuals</code> -- the response residuals</p></li>
<li><p><code>variance</code> -- the root mean square error</p></li>
<li><p><code>fitted_values</code> -- the fitted mean values, obtained by transforming the linear predictors by the inverse of the link function.</p></li>
<li><p><code>link</code> -- the <code>link</code> object used.</p></li>
<li><p><code>linear_predictors</code> -- the linear fit on link scale.</p></li>
<li><p><code>aic</code> --	A version of Akaike's An Information Criterion, minus twice the maximized log-likelihood plus twice the number of parameters.</p></li>
<li><p><code>weights</code> -- vector of estimated weights for non-probability sample.</p></li>
<li><p><code>prior.weights</code> -- the weights initially supplied, a vector of 1s if none were.</p></li>
<li><p><code>formula</code> -- the formula supplied.</p></li>
<li><p><code>df_residual</code> -- the residual degrees of freedom.</p></li>
<li><p><code>log_likelihood</code> -- value of log-likelihood function if <code>mle</code> method, in the other case <code>NA</code>.</p></li>
<li><p><code>cve</code> -- the error for each value of <code>lambda</code>, averaged across the cross-validation folds for variables selection model
when propensity score model is fitting.</p></li>
</ul></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Let <em></em>\(y\) be the response variable for which we want to estimate population mean
given by \[\mu_{y} = \frac{1}{N} \sum_{i=1}^N y_{i}.\] For this purposes we consider data integration
with the following structure. Let <em></em>\(S_A\) be the non-probability sample with design matrix of covariates as
\[
\boldsymbol{X}_A =
  \begin{bmatrix}
x_{11} &amp; x_{12} &amp; \cdots &amp; x_{1p} \cr
x_{21} &amp; x_{22} &amp; \cdots &amp; x_{2p} \cr
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \cr
x_{n_{A}1} &amp; x_{n_{A}2} &amp; \cdots &amp; x_{n_{A}p} \cr
\end{bmatrix}
\]
and vector of outcome variable
\[
\boldsymbol{y} =
  \begin{bmatrix}
y_{1} \cr
y_{2} \cr
\vdots \cr
y_{n_{A}}.
\end{bmatrix}
\]
On the other hand let <em></em>\(S_B\) be the probability sample with design matrix of covariates as
\[
\boldsymbol{X}_B =
  \begin{bmatrix}
x_{11} &amp; x_{12} &amp; \cdots &amp; x_{1p} \cr
x_{21} &amp; x_{22} &amp; \cdots &amp; x_{2p} \cr
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \cr
x_{n_{B}1} &amp; x_{n_{B}2} &amp; \cdots &amp; x_{n_{B}p}. \cr
\end{bmatrix}
\]
Instead of sample of units we can consider vector of population totals in the form of <em></em>\(\tau_x = (\sum_{i \in \mathcal{U}}\boldsymbol{x}_{i1}, \sum_{i \in \mathcal{U}}\boldsymbol{x}_{i2}, ..., \sum_{i \in \mathcal{U}}\boldsymbol{x}_{ip})\) or means
<em></em>\(\frac{\tau_x}{N}\), where <em></em>\(\mathcal{U}\) regards to some finite population. Notice that we do not assume access to the response variable for <em></em>\(S_B\).
Generally we provide following assumptions:</p><ol><li><p>The selection indicator of belonging to non-probability sample <em></em>\(R_{i}\) and the response variable <em></em>\(y_i\) are independent given the set of covariates <em></em>\(\boldsymbol{x}_i\).</p></li>
<li><p>All units have a non-zero propensity score, that is, <em></em>\(\pi_{i}^{A} &gt; 0\) for all i.</p></li>
<li><p>The indicator variables <em></em>\(R_{i}^{A}\) and <em></em>\(R_{j}^{A}\) are independent for given <em></em>\(\boldsymbol{x}_i\) and <em></em>\(\boldsymbol{x}_j\) for <em></em>\(i \neq j\).</p></li>
</ol><p>There are three possible approaches to problem of population mean estimation using non-probability samples:</p><ol><li><p>Inverse probability weighting -- The biggest drawback of the non-probability sampling is unknown selection mechanism for a unit to be included in the sample.
This is why we talk about so called “biased sample” problem.
Inverse probability approach is based on assumption that reference probability sample
is available and therefore we can estimate propensity score of selection mechanism.
Estimator has following form:
\[\hat{\mu}_{IPW} = \frac{1}{N^{A}}\sum_{i \in S_{A}} \frac{y_{i}}{\hat{\pi}_{i}^{A}}.\]
For this purpose with consider multiple ways of estimation. The first approach is Maximum Likelihood Estimation with corrected
log-likelihood function which is given by the following formula
\[
 \ell^{*}(\boldsymbol{\theta}) = \sum_{i \in S_{A}}\log \left\lbrace \frac{\pi(\boldsymbol{x}_{i}, \boldsymbol{\theta})}{1 - \pi(\boldsymbol{x}_{i},\boldsymbol{\theta})}\right\rbrace + \sum_{i \in S_{B}}d_{i}^{B}\log \left\lbrace 1 - \pi({\boldsymbol{x}_{i},\boldsymbol{\theta})}\right\rbrace.\]
In the literature main approach is based on <code>logit</code> link function when it comes to modelling propensity scores <em></em>\(\pi_i^A\),
however we expand propensity score model with the additional link functions, such as <code>cloglog</code> and <code>probit</code>.
The pseudo score equations derived from ML methods can be replaced by idea of generalized estimating equations with calibration constraints defined by equations
\[
 \mathbf{U}(\boldsymbol{\theta})=\sum_{i \in S_A} \mathbf{h}\left(\mathbf{x}_i, \boldsymbol{\theta}\right)-\sum_{i \in S_B} d_i^B \pi\left(\mathbf{x}_i, \boldsymbol{\theta}\right) \mathbf{h}\left(\mathbf{x}_i, \boldsymbol{\theta}\right).\]
Notice that for <em></em>\( \mathbf{h}\left(\mathbf{x}_i, \boldsymbol{\theta}\right) = \frac{\pi(\boldsymbol{x}, \boldsymbol{\theta})}{\boldsymbol{x}}\) we do not require probability
sample and can use vector of population totals/means.</p></li>
<li><p>Mass imputation -- This method relies on framework,
where imputed values of the outcome variables are created for whole probability sample.
In this case we treat big-data sample as a training dataset, which is used to build an imputation model. Using imputed values
for probability sample and design (known) weights, we can build population mean estimator of form:
\[\hat{\mu}_{MI} = \frac{1}{N^B}\sum_{i \in S_{B}} d_{i}^{B} \hat{y}_i.\]
It opens the the door to very flexible method for imputation model. In the package used generalized linear models from <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code>
nearest neighbour algorithm using <code><a href="https://rdrr.io/pkg/RANN/man/nn2.html" class="external-link">RANN::nn2()</a></code> and predictive mean matching.</p></li>
<li><p>Doubly robust estimation -- The IPW and MI estimators are sensible on misspecified models for propensity score and outcome variable respectively.
For this purpose so called doubly-robust methods, which take into account these problems, are presented.
It is quite simple idea of combination propensity score and imputation models during inference which lead to the following estimator
\[\hat{\mu}_{DR} = \frac{1}{N^A}\sum_{i \in S_A} \hat{d}_i^A (y_i - \hat{y}_i) + \frac{1}{N^B}\sum_{i \in S_B} d_i^B \hat{y}_i.\]
In addition, an approach based directly on bias minimisation has been implemented. Following formula
\[
   \begin{aligned}
   bias(\hat{\mu}_{DR}) = &amp; \mathbb{E} (\hat{\mu}_{DR} - \mu) \cr = &amp; \mathbb{E} \left\lbrace \frac{1}{N} \sum_{i=1}^N (\frac{R_i^A}{\pi_i^A (\boldsymbol{x}_i^{\mathrm{T}} \boldsymbol{\theta})}
   - 1 ) (y_i - \operatorname{m}(\boldsymbol{x}_i^{\mathrm{T}} \boldsymbol{\beta})) \right\rbrace \cr + &amp; \mathbb{E} \left\lbrace \frac{1}{N} \sum_{i=1}^N (R_i^B d_i^B - 1) \operatorname{m}( \boldsymbol{x}_i^{\mathrm{T}} \boldsymbol{\beta}) \right\rbrace,
   \end{aligned}
   \]
lead us to system of equations
\[
   \begin{aligned}
   J(\theta, \beta) =
   \left\lbrace
   \begin{array}{c}
                      J_1(\theta, \beta) \cr
                      J_2(\theta, \beta)
                      \end{array}\right\rbrace = \left\lbrace \begin{array}{c}
                                               \sum_{i=1}^N R_i^A\ \left\lbrace \frac{1}{\pi(\boldsymbol{x}_i, \boldsymbol{\theta})}-1 \right\rbrace \left\lbrace y_i-m(\boldsymbol{x}_i, \boldsymbol{\beta}) \right\rbrace \boldsymbol{x}_i \cr
                                               \sum_{i=1}^N \frac{R_i^A}{\pi(\boldsymbol{x}_i, \boldsymbol{\theta})} \frac{\partial m(\boldsymbol{x}_i, \boldsymbol{\beta})}{\partial \boldsymbol{\beta}}
                                               - \sum_{i \in \mathcal{S}_{\mathrm{B}}} d_i^{\mathrm{B}} \frac{\partial m(\boldsymbol{x}_i, \boldsymbol{\beta})}{\partial \boldsymbol{\beta}}
  \end{array} \right\rbrace,
  \end{aligned}
  \]
where <em></em>\(m\left(\boldsymbol{x}_{i}, \boldsymbol{\beta}\right)\) is mass imputation (regression) model for outcome variable and
propensity scores <em></em>\(\pi_i^A\) are estimated using <code>logit</code> function for the model. As in the <code>MLE</code> and <code>GEE</code> approaches we have expanded
this method on <code>cloglog</code> and <code>probit</code> links.</p></li>
</ol><p>Since it is not straightforward thing to calculate variances of these estimators, in the literature proposed are asymptotic equivalents
of variances that are derives using Taylor approximation. Details can be found <a href="https://ncn-foreigners.github.io/nonprobsvy-book/intro.html">here</a>.
Moreover one can use bootstrap approach for variance estimation.</p>
<p>The function also allows the selection of variables with known methods that have been implemented to handle the integration of probability and non-probability sampling.
In the presence of high-dimensional data, variable selection is important, because it can reduce variability in estimation resulting from using irrelevant variables for model building.
Let <em></em>\(\operatorname{U}\left( \boldsymbol{\theta}, \boldsymbol{\beta} \right)\) be the joint estimating function for <em></em>\(\left( \boldsymbol{\theta}, \boldsymbol{\beta} \right)\). We define the
penalized estimating functions as
\[
  \operatorname{U}^p \left(\boldsymbol{\theta}, \boldsymbol{\beta}\right) = \operatorname{U}\left(\boldsymbol{\theta}, \boldsymbol{\beta}\right) - \left\lbrace \begin{array}{c}
  q_{\lambda_\theta}(|\boldsymbol{\theta}|) \operatorname{sgn}(\boldsymbol{\theta}) \
  q_{\lambda_\beta}(|\boldsymbol{\beta}|) \operatorname{sgn}(\boldsymbol{\beta})
  \end{array} \right\rbrace,
  \]
where <em></em>\(\lambda_{\theta}\) and <em></em>\(q_{\lambda_{\beta}}\) are some smooth functions. We let <em></em>\(q_{\lambda} \left(x\right) = \frac{\partial p_{\lambda}}{\partial x}\), where <em></em>\(p_{\lambda}\) is some penalization function.
Details of penalization functions and techniques for solving these types of equations can be found <a href="https://ncn-foreigners.github.io/nonprobsvy-book/variableselection.html">here</a>.
In order to use variables selection model, set the <code>vars_selection</code> parameter in the <code><a href="controlInf.html">controlInf()</a></code> function to <code>TRUE</code>. In addition, in the other control functions such as <code><a href="controlSel.html">controlSel()</a></code> and <code><a href="controlOut.html">controlOut()</a></code>
you can adjust parameters for the selection of the relevant variables, such as number of folds during cross-validation algorithm or lambda value for penalizations. Details can be found
in the documentation of control functions for <code>nonprob</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Kim JK, Park S, Chen Y, Wu C. Combining non-probability and
probability survey samples through mass imputation. J R Stat Soc Series A. 2021;184:941–
963.</p>
<p>Shu Yang, Jae Kwang Kim, Rui Song. Doubly robust inference when combining probability
and non-probability samples with high dimensional data. J. R. Statist. Soc. B (2020)</p>
<p>Yilin Chen , Pengfei Li &amp; Changbao Wu (2020) Doubly Robust Inference
With Nonprobability Survey Samples, Journal of the American Statistical Association, 115:532,
2011-2021</p>
<p>Shu Yang, Jae Kwang Kim and Youngdeok Hwang Integration of data from
probability surveys and big found data for finite population inference using mass imputation.
Survey Methodology, June 2021 29 Vol. 47, No. 1, pp. 29-58</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optim()</a></code> -- For more information on <code>optim</code> function used in
<code>optim</code> method of fitting propensity score model.</p>
<p><code><a href="https://rdrr.io/pkg/maxLik/man/maxLik.html" class="external-link">maxLik::maxLik()</a></code> -- For more information on <code>maxLik</code> function used in
<code>maxLik</code> method of fitting propensity score model.</p>
<p><code><a href="https://rdrr.io/pkg/ncvreg/man/cv.ncvreg.html" class="external-link">ncvreg::cv.ncvreg()</a></code> -- For more information on <code>cv.ncvreg</code> function used in
variable selection model for outcome model.</p>
<p><code><a href="https://rdrr.io/pkg/nleqslv/man/nleqslv.html" class="external-link">nleqslv::nleqslv()</a></code> -- For more information on <code>nleqslv</code> function used in
estimation process of bias minimization approach.</p>
<p><code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code> -- For more information about generalised linear models used during mass imputation process.</p>
<p><code><a href="https://rdrr.io/pkg/RANN/man/nn2.html" class="external-link">RANN::nn2()</a></code> -- For more information about nearest neighbor algorithm used during mass imputation process.</p>
<p><code><a href="controlSel.html">controlSel()</a></code> -- For control parameters related to selection model.</p>
<p><code><a href="controlOut.html">controlOut()</a></code> -- For control parameters related to outcome model.</p>
<p><code><a href="controlInf.html">controlInf()</a></code> -- For control parameters related to statistical inference.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Łukasz Chrostowski, Maciej Beręsewicz</p>
<p><script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># generate data based on Doubly Robust Inference With Nonprobability Survey Samples (2021)</span></span></span>
<span class="r-in"><span><span class="co"># Yilin Chen , Pengfei Li &amp; Changbao Wu</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">sampling</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘sampling’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:survival’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     cluster, strata</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># sizes of population and probability sample</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span>  <span class="fl">20000</span> <span class="co"># population</span></span></span>
<span class="r-in"><span><span class="va">n_b</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co"># probability</span></span></span>
<span class="r-in"><span><span class="co"># data</span></span></span>
<span class="r-in"><span><span class="va">z1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html" class="external-link">rchisq</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># covariates</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">z1</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="va">z2</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="va">z2</span></span></span>
<span class="r-in"><span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="va">z3</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="op">(</span><span class="va">z1</span> <span class="op">+</span> <span class="va">z2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x4</span> <span class="op">&lt;-</span> <span class="va">z4</span> <span class="op">+</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">z1</span> <span class="op">+</span> <span class="va">z2</span> <span class="op">+</span> <span class="va">z3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sigma_30</span> <span class="op">&lt;-</span> <span class="fl">10.4</span></span></span>
<span class="r-in"><span><span class="va">sigma_50</span> <span class="op">&lt;-</span> <span class="fl">5.2</span></span></span>
<span class="r-in"><span><span class="va">sigma_80</span> <span class="op">&lt;-</span> <span class="fl">2.4</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># response variables</span></span></span>
<span class="r-in"><span><span class="va">y30</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">+</span> <span class="va">x1</span>  <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">sigma_30</span><span class="op">*</span><span class="va">epsilon</span></span></span>
<span class="r-in"><span><span class="va">y50</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">+</span> <span class="va">x1</span>  <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">sigma_50</span><span class="op">*</span><span class="va">epsilon</span></span></span>
<span class="r-in"><span><span class="va">y80</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">+</span> <span class="va">x1</span>  <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">sigma_80</span><span class="op">*</span><span class="va">epsilon</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># population</span></span></span>
<span class="r-in"><span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">y30</span>, <span class="va">y50</span>, <span class="va">y80</span>, <span class="va">x1</span>, <span class="va">x2</span>, <span class="va">x3</span>, <span class="va">x4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## propensity score model for nonprobability sample (sum to 1000)</span></span></span>
<span class="r-in"><span><span class="va">eta</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">4.461</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">*</span><span class="va">x1</span> <span class="op">+</span> <span class="fl">0.2</span><span class="op">*</span><span class="va">x2</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">*</span><span class="va">x3</span> <span class="op">+</span> <span class="fl">0.2</span><span class="op">*</span><span class="va">x4</span></span></span>
<span class="r-in"><span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># inclusion probabilities for probability sample</span></span></span>
<span class="r-in"><span><span class="va">z_prob</span> <span class="op">&lt;-</span> <span class="va">x3</span><span class="op">+</span><span class="fl">0.2051</span></span></span>
<span class="r-in"><span><span class="va">sim_data</span><span class="op">$</span><span class="va">p_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sampling/man/inclusionprobabilities.html" class="external-link">inclusionprobabilities</a></span><span class="op">(</span><span class="va">z_prob</span>, n <span class="op">=</span> <span class="va">n_b</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># data</span></span></span>
<span class="r-in"><span><span class="va">sim_data</span><span class="op">$</span><span class="va">flag_nonprob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sampling/man/UPpoisson.html" class="external-link">UPpoisson</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span> <span class="co">## sampling nonprob</span></span></span>
<span class="r-in"><span><span class="va">sim_data</span><span class="op">$</span><span class="va">flag_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sampling/man/UPpoisson.html" class="external-link">UPpoisson</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">$</span><span class="va">p_prob</span><span class="op">)</span> <span class="co">## sampling prob</span></span></span>
<span class="r-in"><span><span class="va">nonprob_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">sim_data</span>, <span class="va">flag_nonprob</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="co">## nonprobability sample</span></span></span>
<span class="r-in"><span><span class="va">svyprob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>ids<span class="op">=</span><span class="op">~</span><span class="fl">1</span>, probs <span class="op">=</span> <span class="op">~</span> <span class="va">p_prob</span>,</span></span>
<span class="r-in"><span>                     data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">sim_data</span>, <span class="va">flag_prob</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     pps <span class="op">=</span> <span class="st">"brewer"</span><span class="op">)</span> <span class="co">## probability sample</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## mass imputation estimator</span></span></span>
<span class="r-in"><span><span class="va">MI_res</span> <span class="op">&lt;-</span> <span class="fu">nonprob</span><span class="op">(</span>outcome <span class="op">=</span> <span class="va">y80</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span>,</span></span>
<span class="r-in"><span>                  data <span class="op">=</span> <span class="va">nonprob_df</span>,</span></span>
<span class="r-in"><span>                  svydesign <span class="op">=</span> <span class="va">svyprob</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">MI_res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nonprob(data = nonprob_df, outcome = y80 ~ x1 + x2 + x3 + x4, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     svydesign = svyprob)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimated population mean: 9.518 with overall std.err of: 0.151</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> And std.err for nonprobability and probability samples being respectively:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.08679 and 0.1236</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 95% Confidence inverval for popualtion mean:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lower_bound upper_bound</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y80    9.222349    9.814346</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Based on: Mass Imputation method</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> For a population of estimate size: 21631.63</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Obtained on a nonprobability sample of size: 1032</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> With an auxiliary probability sample of size: 1044</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Regression coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -----------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> For glm regression on outcome variable:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error z value  P(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  1.93113    0.24859   7.768 7.95e-15 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1           1.06616    0.16954   6.289 3.20e-10 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2           1.04125    0.09731  10.700  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x3           0.98891    0.06927  14.277  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x4           0.98930    0.01904  51.946  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">## inverse probability weighted estimator</span></span></span>
<span class="r-in"><span><span class="va">IPW_res</span> <span class="op">&lt;-</span> <span class="fu">nonprob</span><span class="op">(</span>selection <span class="op">=</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span>,</span></span>
<span class="r-in"><span>                   target <span class="op">=</span> <span class="op">~</span> <span class="va">y80</span>,</span></span>
<span class="r-in"><span>                   data <span class="op">=</span> <span class="va">nonprob_df</span>,</span></span>
<span class="r-in"><span>                   svydesign <span class="op">=</span> <span class="va">svyprob</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">IPW_res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nonprob(data = nonprob_df, selection = ~x1 + x2 + x3 + x4, target = ~y80, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     svydesign = svyprob)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimated population mean: 9.718 with overall std.err of: 0.2375</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> And std.err for nonprobability and probability samples being respectively:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.1887 and 0.1442</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 95% Confidence inverval for popualtion mean:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lower_bound upper_bound</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y80    9.252143    10.18302</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Based on: Inverse probability weighted method</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> For a population of estimate size: 21127.35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Obtained on a nonprobability sample of size: 1032</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> With an auxiliary probability sample of size: 1044</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Regression coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -----------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> For glm regression on selection variable:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Estimate Std. Error z value  P(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -4.582627   0.105508 -43.434  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1           0.102629   0.074416   1.379    0.168    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2           0.234843   0.042871   5.478 4.30e-08 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x3           0.181632   0.029253   6.209 5.33e-10 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x4           0.184285   0.008568  21.508  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weights:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1.172  10.583  18.137  20.472  27.939  79.562 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -0.56121 -0.04204 -0.01457  0.43052  0.94475  0.98743 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 7797.97</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BIC: 7826.161</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-Likelihood: -3893.985 on 2071 Degrees of freedom</span>
<span class="r-in"><span><span class="co">## doubly robust estimator</span></span></span>
<span class="r-in"><span><span class="va">DR_res</span> <span class="op">&lt;-</span> <span class="fu">nonprob</span><span class="op">(</span>outcome <span class="op">=</span> <span class="va">y80</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span>,</span></span>
<span class="r-in"><span>                  selection <span class="op">=</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span>,</span></span>
<span class="r-in"><span>                  data <span class="op">=</span> <span class="va">nonprob_df</span>,</span></span>
<span class="r-in"><span>                  svydesign <span class="op">=</span> <span class="va">svyprob</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">DR_res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nonprob(data = nonprob_df, selection = ~x1 + x2 + x3 + x4, outcome = y80 ~ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     x1 + x2 + x3 + x4, svydesign = svyprob)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimated population mean: 9.483 with overall std.err of: 0.1525</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> And std.err for nonprobability and probability samples being respectively:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.08508 and 0.1265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 95% Confidence inverval for popualtion mean:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lower_bound upper_bound</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y80    9.183858    9.781461</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Based on: Doubly-Robust method</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> For a population of estimate size: 21127.35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Obtained on a nonprobability sample of size: 1032</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> With an auxiliary probability sample of size: 1044</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Regression coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -----------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> For glm regression on outcome variable:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error z value  P(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  1.93113    0.24859   7.768 7.95e-15 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1           1.06616    0.16954   6.289 3.20e-10 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2           1.04125    0.09731  10.700  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x3           0.98891    0.06927  14.277  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x4           0.98930    0.01904  51.946  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -----------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> For glm regression on selection variable:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Estimate Std. Error z value  P(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -4.582627   0.105508 -43.434  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1           0.102629   0.074416   1.379    0.168    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2           0.234843   0.042871   5.478 4.30e-08 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x3           0.181632   0.029253   6.209 5.33e-10 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x4           0.184285   0.008568  21.508  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weights:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1.172  10.583  18.137  20.472  27.939  79.562 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -0.56121 -0.04204 -0.01457  0.43052  0.94475  0.98743 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 7797.97</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BIC: 7826.161</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-Likelihood: -3893.985 on 2071 Degrees of freedom</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Łukasz Chrostowski, Maciej Beręsewicz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

